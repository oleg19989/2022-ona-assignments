"0",""
"0","library(arrow)"
"2","Warning:"
"2"," package â€˜arrowâ€™ was built under R version 4.1.3
"
"2","
Attaching package: â€˜arrowâ€™

"
"2","The following object is masked from â€˜package:utilsâ€™:

    timestamp

"
"0","library(readr)"
"0","applications <- read_parquet(paste0('C:\\Users\\oleg1\\Desktop\\McGill\\Classes\\Organizational Network Analysis\\app_data_sample.parquet'))"
"0","edges <- read_csv(paste0('C:\\Users\\oleg1\\Desktop\\McGill\\Classes\\Organizational Network Analysis\\edges_sample.csv'))"
"1","[1mRows: [22m[34m32906[39m [1mColumns: [22m[34m4[39m
"
"1","[36m--[39m [1mColumn specification[22m [36m----------------------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "",""
[31mchr[39m  (1): application_number
[32mdbl[39m  (2): ego_examiner_id, alter_examiner_id
[34mdate[39m (1): advice_date
"
"1","
[36mi[39m Use [38;5;235m[48;5;253m[38;5;235m[48;5;253m`spec()`[48;5;253m[38;5;235m[49m[39m to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set [38;5;235m[48;5;253m[38;5;235m[48;5;253m`show_col_types = FALSE`[48;5;253m[38;5;235m[49m[39m to quiet this message.
"
"0","library(gender)"
"0","library(tidyverse)"
"2","Warning:"
"2"," package â€˜tidyverseâ€™ was built under R version 4.1.3
"
"2","Registered S3 methods overwritten by 'dbplyr':
  method         from
  print.tbl_lazy     
  print.tbl_sql      
"
"2","[30m-- [1mAttaching packages[22m ----------------------------------------------------------------------------------------------------------- tidyverse 1.3.1 --[39m
"
"2","[30m[32mv[30m [34mggplot2[30m 3.3.5     [32mv[30m [34mdplyr  [30m 1.0.7
[32mv[30m [34mtibble [30m 3.1.6     [32mv[30m [34mstringr[30m 1.4.0
[32mv[30m [34mtidyr  [30m 1.1.4     [32mv[30m [34mforcats[30m 0.5.1
[32mv[30m [34mpurrr  [30m 0.3.4     [39m
"
"2","[30m-- [1mConflicts[22m -------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
[31mx[30m [34mdplyr[30m::[32mfilter()[30m masks [34mstats[30m::filter()
[31mx[30m [34mdplyr[30m::[32mlag()[30m    masks [34mstats[30m::lag()[39m
"
"0","#install_genderdata_package() # only run this line the first time you use the package, to get data for it"
"0",""
"0","# get a list of first names without repetitions"
"0","examiner_names <- applications %>% "
"0","  distinct(examiner_name_first)"
"0",""
"0",""
"0","# get a table of names and gender"
"0","examiner_names_gender <- examiner_names %>% "
"0","  do(results = gender(.$examiner_name_first, method = ""ssa"")) %>% "
"0","  unnest(cols = c(results), keep_empty = TRUE) %>% "
"0","  select("
"0","    examiner_name_first = name,"
"0","    gender,"
"0","    proportion_female"
"0","  )"
"0",""
"0",""
"0","# remove extra colums from the gender table"
"0","examiner_names_gender <- examiner_names_gender %>% "
"0","  select(examiner_name_first, gender)"
"0",""
"0","# joining gender back to the dataset"
"0","applications <- applications %>% "
"0","  left_join(examiner_names_gender, by = ""examiner_name_first"")"
"0",""
"0","# cleaning up"
"0","rm(examiner_names)"
"0","rm(examiner_names_gender)"
"0","gc()"
"1","      "
"1","     used"
"1","  (Mb)"
"1"," gc trigger"
"1","  (Mb)"
"1"," max used"
"1","  (Mb)"
"1","
Ncells"
"1","  4790943"
"1"," 255.9"
"1","    8211140"
"1"," 438.6"
"1","  4794723"
"1"," 256.1"
"1","
Vcells"
"1"," 57635799"
"1"," 439.8"
"1","   88211582"
"1"," 673.1"
"1"," 87917436"
"1"," 670.8"
"1","
"
"0","library(wru)"
"0",""
"0","examiner_surnames <- applications %>% "
"0","  select(surname = examiner_name_last) %>% "
"0","  distinct()"
"0",""
"0",""
"0","examiner_race <- predict_race(voter.file = examiner_surnames, surname.only = T) %>% "
"0","  as_tibble()"
"1","[1]"
"1"," ""Proceeding with surname-only predictions..."""
"1","
"
"2","Warning in merge_surnames(voter.file) :"
"2","
 "
"2"," Probabilities were imputed for 698 surnames that could not be matched to Census list.
"
"0","examiner_race <- examiner_race %>% "
"0","  mutate(max_race_p = pmax(pred.asi, pred.bla, pred.his, pred.oth, pred.whi)) %>% "
"0","  mutate(race = case_when("
"0","    max_race_p == pred.asi ~ ""Asian"","
"0","    max_race_p == pred.bla ~ ""black"","
"0","    max_race_p == pred.his ~ ""Hispanic"","
"0","    max_race_p == pred.oth ~ ""other"","
"0","    max_race_p == pred.whi ~ ""white"","
"0","    TRUE ~ NA_character_"
"0","  ))"
"0",""
"0",""
"0",""
"0","# removing extra columns"
"0","examiner_race <- examiner_race %>% "
"0","  select(surname,race)"
"0",""
"0","applications <- applications %>% "
"0","  left_join(examiner_race, by = c(""examiner_name_last"" = ""surname""))"
"0",""
"0","rm(examiner_race)"
"0","rm(examiner_surnames)"
"0","gc()"
"1","      "
"1","     used"
"1","  (Mb)"
"1"," gc trigger"
"1","  (Mb)"
"1","  max used"
"1","  (Mb)"
"1","
Ncells"
"1","  5205355"
"1"," 278.0"
"1","    8211140"
"1"," 438.6"
"1","   8211140"
"1"," 438.6"
"1","
Vcells"
"1"," 61434424"
"1"," 468.8"
"1","  109738859"
"1"," 837.3"
"1"," 109195654"
"1"," 833.1"
"1","
"
"0","library(lubridate) # to work with dates"
"2","
Attaching package: â€˜lubridateâ€™

"
"2","The following object is masked from â€˜package:arrowâ€™:

    duration

"
"2","The following objects are masked from â€˜package:baseâ€™:

    date, intersect, setdiff, union

"
"0","examiner_dates <- applications %>% "
"0","  select(examiner_id, filing_date, appl_status_date) "
"0",""
"0",""
"0","examiner_dates <- examiner_dates %>% "
"0","  mutate(start_date = ymd(filing_date), end_date = as_date(dmy_hms(appl_status_date)))"
"0",""
"0","examiner_dates <- examiner_dates %>% "
"0","  group_by(examiner_id) %>% "
"0","  summarise("
"0","    earliest_date = min(start_date, na.rm = TRUE), "
"0","    latest_date = max(end_date, na.rm = TRUE),"
"0","    tenure_days = interval(earliest_date, latest_date) %/% days(1)"
"0","  ) %>% "
"0","  filter(year(latest_date)<2018)"
"0",""
"0","applications <- applications %>% "
"0","  left_join(examiner_dates, by = ""examiner_id"")"
"0",""
"0","rm(examiner_dates)"
"0","gc()"
"1","      "
"1","     used"
"1","  (Mb)"
"1"," gc trigger"
"1","   (Mb)"
"1","  max used"
"1","   (Mb)"
"1","
Ncells"
"1","  5219797"
"1"," 278.8"
"1","   14449234"
"1","  771.7"
"1","  14449234"
"1","  771.7"
"1","
Vcells"
"1"," 73813902"
"1"," 563.2"
"1","  158199956"
"1"," 1207.0"
"1"," 158144586"
"1"," 1206.6"
"1","
"
